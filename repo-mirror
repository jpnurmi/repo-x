#!/bin/sh

set -e

x=false

function usage() {
    echo "Usage: $(basename $0) [options]"
    echo ""
    echo "Runs 'repo-sync' and 'repo-lfs-fetch' in 'REPO_MIRROR_LOCATION'."
    echo ""
    echo "Options:"
    echo "-h,--help"
    echo "-j,--jobs <jobs>"
    echo "-x"
    exit $1
}

for opt in "$@"; do
    case "$opt" in
        -h|--help)
            usage
            ;;
        -x)
            x=true
            ;;
    esac
done

if [ $x = true ]; then
    echo "cd $REPO_MIRROR_LOCATION"
elif [ -z "$REPO_MIRROR_LOCATION" ]; then
    echo "ERROR: REPO_MIRROR_LOCATION not set" >&2
    exit 1
elif [ ! -d "$REPO_MIRROR_LOCATION" ]; then
    mkdir -p "$REPO_MIRROR_LOCATION"
    cd "$REPO_MIRROR_LOCATION"
    repo-init --mirror
else
    cd "$REPO_MIRROR_LOCATION"
fi
repo-sync "$@"
repo-lfs-fetch "$@"
